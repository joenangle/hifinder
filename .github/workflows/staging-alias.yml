name: Update Staging Alias

on:
  push:
    branches: [staging]

jobs:
  update-staging-alias:
    runs-on: ubuntu-latest

    steps:
      - name: Wait for Vercel deployment
        uses: patrickedqvist/wait-for-vercel-preview@v1.3.1
        id: wait-for-deployment
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          max_timeout: 180  # 3 minutes (builds take ~68 seconds)
          check_interval: 5  # Check every 5 seconds

      - name: Install Vercel CLI
        run: npm install --global vercel@latest

      - name: Update staging.hifinder.app alias
        run: |
          echo "Deployment URL: ${{ steps.wait-for-deployment.outputs.url }}"
          vercel alias set "${{ steps.wait-for-deployment.outputs.url }}" staging.hifinder.app \
            --token "${{ secrets.VERCEL_TOKEN }}" \
            --scope "${{ secrets.VERCEL_ORG_ID }}"
          echo "âœ… Successfully updated staging.hifinder.app!"
