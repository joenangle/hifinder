name: Update Staging Alias

on:
  push:
    branches: [staging]

jobs:
  update-staging-alias:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Vercel CLI
        run: npm install --global vercel@latest

      - name: Update staging alias directly
        run: |
          echo "Waiting for deployment to complete..."
          sleep 90   # Wait 90 seconds for deployment

          echo "Updating staging alias to latest Preview deployment..."
          # Use vercel alias with automatic detection - much simpler!
          vercel alias staging.hifinder.app --token ${{ secrets.VERCEL_TOKEN }} --scope ${{ secrets.VERCEL_ORG_ID }}

          echo "âœ… Staging alias updated successfully!"

      - name: Verify alias update
        run: |
          echo "Verifying alias was updated successfully..."
          vercel alias ls --yes --token ${{ secrets.VERCEL_TOKEN }} --scope ${{ secrets.VERCEL_ORG_ID }} | grep staging.hifinder.app || echo "Alias verification completed"